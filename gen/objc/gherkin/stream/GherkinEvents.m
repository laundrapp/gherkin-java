//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/marcussmith/HambroPerks/laundrapp_org/gherkin-java/src/main/java/gherkin/stream/GherkinEvents.java
//

#include "J2ObjC_source.h"
#include "gherkin/AstBuilder.h"
#include "gherkin/Parser.h"
#include "gherkin/ParserException.h"
#include "gherkin/TokenMatcher.h"
#include "gherkin/ast/GherkinDocument.h"
#include "gherkin/ast/Location.h"
#include "gherkin/events/AttachmentEvent.h"
#include "gherkin/events/GherkinDocumentEvent.h"
#include "gherkin/events/PickleEvent.h"
#include "gherkin/events/SourceEvent.h"
#include "gherkin/pickles/Compiler.h"
#include "gherkin/pickles/Pickle.h"
#include "gherkin/stream/GherkinEvents.h"
#include "java/lang/Iterable.h"
#include "java/util/ArrayList.h"
#include "java/util/List.h"

@interface GherkinStreamGherkinEvents () {
 @public
  GherkinParser *parser_;
  GherkinTokenMatcher *matcher_;
  GherkinPicklesCompiler *compiler_;
  jboolean printSource_;
  jboolean printAst_;
  jboolean printPickles_;
}

@end

J2OBJC_FIELD_SETTER(GherkinStreamGherkinEvents, parser_, GherkinParser *)
J2OBJC_FIELD_SETTER(GherkinStreamGherkinEvents, matcher_, GherkinTokenMatcher *)
J2OBJC_FIELD_SETTER(GherkinStreamGherkinEvents, compiler_, GherkinPicklesCompiler *)

__attribute__((unused)) static void GherkinStreamGherkinEvents_addErrorAttachmentWithJavaUtilList_withGherkinParserException_withNSString_(GherkinStreamGherkinEvents *self, id<JavaUtilList> cucumberEvents, GherkinParserException *e, NSString *uri);

@implementation GherkinStreamGherkinEvents

- (instancetype)initWithBoolean:(jboolean)printSource
                    withBoolean:(jboolean)printAst
                    withBoolean:(jboolean)printPickles {
  GherkinStreamGherkinEvents_initWithBoolean_withBoolean_withBoolean_(self, printSource, printAst, printPickles);
  return self;
}

- (id<JavaLangIterable>)iterableWithGherkinEventsSourceEvent:(GherkinEventsSourceEvent *)sourceEvent {
  id<JavaUtilList> cucumberEvents = create_JavaUtilArrayList_init();
  @try {
    GherkinAstGherkinDocument *gherkinDocument = [((GherkinParser *) nil_chk(parser_)) parseWithNSString:((GherkinEventsSourceEvent *) nil_chk(sourceEvent))->data_ withGherkinParser_ITokenMatcher:matcher_];
    if (printSource_) {
      [cucumberEvents addWithId:sourceEvent];
    }
    if (printAst_) {
      [cucumberEvents addWithId:create_GherkinEventsGherkinDocumentEvent_initWithNSString_withGherkinAstGherkinDocument_(sourceEvent->uri_, gherkinDocument)];
    }
    if (printPickles_) {
      id<JavaUtilList> pickles = [((GherkinPicklesCompiler *) nil_chk(compiler_)) compileWithGherkinAstGherkinDocument:gherkinDocument];
      for (GherkinPicklesPickle * __strong pickle in nil_chk(pickles)) {
        [cucumberEvents addWithId:create_GherkinEventsPickleEvent_initWithNSString_withGherkinPicklesPickle_(sourceEvent->uri_, pickle)];
      }
    }
  }
  @catch (GherkinParserException_CompositeParserException *e) {
    for (GherkinParserException * __strong error in nil_chk(e->errors_)) {
      GherkinStreamGherkinEvents_addErrorAttachmentWithJavaUtilList_withGherkinParserException_withNSString_(self, cucumberEvents, error, sourceEvent->uri_);
    }
  }
  @catch (GherkinParserException *e) {
    GherkinStreamGherkinEvents_addErrorAttachmentWithJavaUtilList_withGherkinParserException_withNSString_(self, cucumberEvents, e, sourceEvent->uri_);
  }
  return cucumberEvents;
}

- (void)dealloc {
  RELEASE_(parser_);
  RELEASE_(matcher_);
  RELEASE_(compiler_);
  [super dealloc];
}

@end

void GherkinStreamGherkinEvents_initWithBoolean_withBoolean_withBoolean_(GherkinStreamGherkinEvents *self, jboolean printSource, jboolean printAst, jboolean printPickles) {
  NSObject_init(self);
  JreStrongAssignAndConsume(&self->parser_, new_GherkinParser_initWithGherkinParser_Builder_(create_GherkinAstBuilder_init()));
  JreStrongAssignAndConsume(&self->matcher_, new_GherkinTokenMatcher_init());
  JreStrongAssignAndConsume(&self->compiler_, new_GherkinPicklesCompiler_init());
  self->printSource_ = printSource;
  self->printAst_ = printAst;
  self->printPickles_ = printPickles;
}

GherkinStreamGherkinEvents *new_GherkinStreamGherkinEvents_initWithBoolean_withBoolean_withBoolean_(jboolean printSource, jboolean printAst, jboolean printPickles) {
  J2OBJC_NEW_IMPL(GherkinStreamGherkinEvents, initWithBoolean_withBoolean_withBoolean_, printSource, printAst, printPickles)
}

GherkinStreamGherkinEvents *create_GherkinStreamGherkinEvents_initWithBoolean_withBoolean_withBoolean_(jboolean printSource, jboolean printAst, jboolean printPickles) {
  J2OBJC_CREATE_IMPL(GherkinStreamGherkinEvents, initWithBoolean_withBoolean_withBoolean_, printSource, printAst, printPickles)
}

void GherkinStreamGherkinEvents_addErrorAttachmentWithJavaUtilList_withGherkinParserException_withNSString_(GherkinStreamGherkinEvents *self, id<JavaUtilList> cucumberEvents, GherkinParserException *e, NSString *uri) {
  [((id<JavaUtilList>) nil_chk(cucumberEvents)) addWithId:create_GherkinEventsAttachmentEvent_initWithGherkinEventsAttachmentEvent_SourceRef_withNSString_(create_GherkinEventsAttachmentEvent_SourceRef_initWithNSString_withGherkinEventsAttachmentEvent_Location_(uri, create_GherkinEventsAttachmentEvent_Location_initWithInt_withInt_([((GherkinAstLocation *) nil_chk(((GherkinParserException *) nil_chk(e))->location_)) getLine], [e->location_ getColumn])), [e getMessage])];
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(GherkinStreamGherkinEvents)
