//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/nbransby/Documents/gherkin-java/src/main/java/gherkin/TokenMatcher.java
//

#include "J2ObjC_source.h"
#include "gherkin/GherkinDialect.h"
#include "gherkin/GherkinDialectProvider.h"
#include "gherkin/GherkinLanguageConstants.h"
#include "gherkin/IGherkinDialectProvider.h"
#include "gherkin/IGherkinLine.h"
#include "gherkin/Parser.h"
#include "gherkin/Token.h"
#include "gherkin/TokenMatcher.h"
#include "gherkin/ast/Location.h"
#include "java/lang/Integer.h"
#include "java/util/List.h"
#include "java/util/regex/Matcher.h"
#include "java/util/regex/Pattern.h"

@interface GHKTokenMatcher () {
 @public
  id<GHKIGherkinDialectProvider> dialectProvider_;
  GHKGherkinDialect *currentDialect_;
  NSString *activeDocStringSeparator_;
  jint indentToRemove_;
}

@end

J2OBJC_FIELD_SETTER(GHKTokenMatcher, dialectProvider_, id<GHKIGherkinDialectProvider>)
J2OBJC_FIELD_SETTER(GHKTokenMatcher, currentDialect_, GHKGherkinDialect *)
J2OBJC_FIELD_SETTER(GHKTokenMatcher, activeDocStringSeparator_, NSString *)

inline JavaUtilRegexPattern *GHKTokenMatcher_get_LANGUAGE_PATTERN(void);
static JavaUtilRegexPattern *GHKTokenMatcher_LANGUAGE_PATTERN;
J2OBJC_STATIC_FIELD_OBJ_FINAL(GHKTokenMatcher, LANGUAGE_PATTERN, JavaUtilRegexPattern *)

__attribute__((unused)) static jboolean GHKTokenMatcher_matchTitleLineWithGHKToken_withGHKParser_TokenType_withJavaUtilList_(GHKTokenMatcher *self, GHKToken *token, GHKParser_TokenType *tokenType, id<JavaUtilList> keywords);

__attribute__((unused)) static jboolean GHKTokenMatcher_match_DocStringSeparatorWithGHKToken_withNSString_withBoolean_(GHKTokenMatcher *self, GHKToken *token, NSString *separator, jboolean isOpen);

__attribute__((unused)) static NSString *GHKTokenMatcher_unescapeDocStringWithNSString_(GHKTokenMatcher *self, NSString *text);

J2OBJC_INITIALIZED_DEFN(GHKTokenMatcher)

@implementation GHKTokenMatcher

- (instancetype __nonnull)initWithGHKIGherkinDialectProvider:(id<GHKIGherkinDialectProvider>)dialectProvider {
  GHKTokenMatcher_initWithGHKIGherkinDialectProvider_(self, dialectProvider);
  return self;
}

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype __nonnull)init {
  GHKTokenMatcher_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

- (instancetype __nonnull)initWithNSString:(NSString *)defaultDialectName {
  GHKTokenMatcher_initWithNSString_(self, defaultDialectName);
  return self;
}

- (void)reset {
  JreStrongAssign(&activeDocStringSeparator_, nil);
  indentToRemove_ = 0;
  JreStrongAssign(&currentDialect_, [((id<GHKIGherkinDialectProvider>) nil_chk(dialectProvider_)) getDefaultDialect]);
}

- (GHKGherkinDialect *)getCurrentDialect {
  return currentDialect_;
}

- (void)setTokenMatchedWithGHKToken:(GHKToken *)token
            withGHKParser_TokenType:(GHKParser_TokenType *)matchedType
                       withNSString:(NSString *)text
                       withNSString:(NSString *)keyword
                withJavaLangInteger:(JavaLangInteger *)indent
                   withJavaUtilList:(id<JavaUtilList>)items {
  JreStrongAssign(&((GHKToken *) nil_chk(token))->matchedType_, matchedType);
  JreStrongAssign(&token->matchedKeyword_, keyword);
  JreStrongAssign(&token->matchedText_, text);
  JreStrongAssign(&token->mathcedItems_, items);
  JreStrongAssign(&token->matchedGherkinDialect_, [self getCurrentDialect]);
  token->matchedIndent_ = indent != nil ? [indent intValue] : (token->line_ == nil ? 0 : [((JavaLangInteger *) nil_chk([token->line_ indent])) intValue]);
  JreStrongAssignAndConsume(&token->location_, new_GHKALocation_initWithInt_withInt_([((GHKALocation *) nil_chk(token->location_)) getLine], token->matchedIndent_ + 1));
}

- (jboolean)match_EOFWithGHKToken:(GHKToken *)token {
  if ([((GHKToken *) nil_chk(token)) isEOF]) {
    [self setTokenMatchedWithGHKToken:token withGHKParser_TokenType:JreLoadEnum(GHKParser_TokenType, EOF) withNSString:nil withNSString:nil withJavaLangInteger:nil withJavaUtilList:nil];
    return true;
  }
  return false;
}

- (jboolean)match_OtherWithGHKToken:(GHKToken *)token {
  NSString *text = [((id<GHKIGherkinLine>) nil_chk(((GHKToken *) nil_chk(token))->line_)) getLineTextWithInt:indentToRemove_];
  [self setTokenMatchedWithGHKToken:token withGHKParser_TokenType:JreLoadEnum(GHKParser_TokenType, Other) withNSString:GHKTokenMatcher_unescapeDocStringWithNSString_(self, text) withNSString:nil withJavaLangInteger:JavaLangInteger_valueOfWithInt_(0) withJavaUtilList:nil];
  return true;
}

- (jboolean)match_EmptyWithGHKToken:(GHKToken *)token {
  if ([((id<GHKIGherkinLine>) nil_chk(((GHKToken *) nil_chk(token))->line_)) isEmpty]) {
    [self setTokenMatchedWithGHKToken:token withGHKParser_TokenType:JreLoadEnum(GHKParser_TokenType, Empty) withNSString:nil withNSString:nil withJavaLangInteger:nil withJavaUtilList:nil];
    return true;
  }
  return false;
}

- (jboolean)match_CommentWithGHKToken:(GHKToken *)token {
  if ([((id<GHKIGherkinLine>) nil_chk(((GHKToken *) nil_chk(token))->line_)) startsWithWithNSString:GHKGherkinLanguageConstants_COMMENT_PREFIX]) {
    NSString *text = [token->line_ getLineTextWithInt:0];
    [self setTokenMatchedWithGHKToken:token withGHKParser_TokenType:JreLoadEnum(GHKParser_TokenType, Comment) withNSString:text withNSString:nil withJavaLangInteger:JavaLangInteger_valueOfWithInt_(0) withJavaUtilList:nil];
    return true;
  }
  return false;
}

- (jboolean)match_LanguageWithGHKToken:(GHKToken *)token {
  JavaUtilRegexMatcher *matcher = [((JavaUtilRegexPattern *) nil_chk(GHKTokenMatcher_LANGUAGE_PATTERN)) matcherWithJavaLangCharSequence:[((id<GHKIGherkinLine>) nil_chk(((GHKToken *) nil_chk(token))->line_)) getLineTextWithInt:0]];
  if ([((JavaUtilRegexMatcher *) nil_chk(matcher)) matches]) {
    NSString *language = [matcher groupWithInt:1];
    [self setTokenMatchedWithGHKToken:token withGHKParser_TokenType:JreLoadEnum(GHKParser_TokenType, Language) withNSString:language withNSString:nil withJavaLangInteger:nil withJavaUtilList:nil];
    JreStrongAssign(&currentDialect_, [((id<GHKIGherkinDialectProvider>) nil_chk(dialectProvider_)) getDialectWithNSString:language withGHKALocation:token->location_]);
    return true;
  }
  return false;
}

- (jboolean)match_TagLineWithGHKToken:(GHKToken *)token {
  if ([((id<GHKIGherkinLine>) nil_chk(((GHKToken *) nil_chk(token))->line_)) startsWithWithNSString:GHKGherkinLanguageConstants_TAG_PREFIX]) {
    [self setTokenMatchedWithGHKToken:token withGHKParser_TokenType:JreLoadEnum(GHKParser_TokenType, TagLine) withNSString:nil withNSString:nil withJavaLangInteger:nil withJavaUtilList:[token->line_ getTags]];
    return true;
  }
  return false;
}

- (jboolean)match_FeatureLineWithGHKToken:(GHKToken *)token {
  return GHKTokenMatcher_matchTitleLineWithGHKToken_withGHKParser_TokenType_withJavaUtilList_(self, token, JreLoadEnum(GHKParser_TokenType, FeatureLine), [((GHKGherkinDialect *) nil_chk(currentDialect_)) getFeatureKeywords]);
}

- (jboolean)match_BackgroundLineWithGHKToken:(GHKToken *)token {
  return GHKTokenMatcher_matchTitleLineWithGHKToken_withGHKParser_TokenType_withJavaUtilList_(self, token, JreLoadEnum(GHKParser_TokenType, BackgroundLine), [((GHKGherkinDialect *) nil_chk(currentDialect_)) getBackgroundKeywords]);
}

- (jboolean)match_ScenarioLineWithGHKToken:(GHKToken *)token {
  return GHKTokenMatcher_matchTitleLineWithGHKToken_withGHKParser_TokenType_withJavaUtilList_(self, token, JreLoadEnum(GHKParser_TokenType, ScenarioLine), [((GHKGherkinDialect *) nil_chk(currentDialect_)) getScenarioKeywords]);
}

- (jboolean)match_ScenarioOutlineLineWithGHKToken:(GHKToken *)token {
  return GHKTokenMatcher_matchTitleLineWithGHKToken_withGHKParser_TokenType_withJavaUtilList_(self, token, JreLoadEnum(GHKParser_TokenType, ScenarioOutlineLine), [((GHKGherkinDialect *) nil_chk(currentDialect_)) getScenarioOutlineKeywords]);
}

- (jboolean)match_ExamplesLineWithGHKToken:(GHKToken *)token {
  return GHKTokenMatcher_matchTitleLineWithGHKToken_withGHKParser_TokenType_withJavaUtilList_(self, token, JreLoadEnum(GHKParser_TokenType, ExamplesLine), [((GHKGherkinDialect *) nil_chk(currentDialect_)) getExamplesKeywords]);
}

- (jboolean)match_DocStringSeparatorWithGHKToken:(GHKToken *)token {
  return activeDocStringSeparator_ == nil ? GHKTokenMatcher_match_DocStringSeparatorWithGHKToken_withNSString_withBoolean_(self, token, GHKGherkinLanguageConstants_DOCSTRING_SEPARATOR, true) || GHKTokenMatcher_match_DocStringSeparatorWithGHKToken_withNSString_withBoolean_(self, token, GHKGherkinLanguageConstants_DOCSTRING_ALTERNATIVE_SEPARATOR, true) : GHKTokenMatcher_match_DocStringSeparatorWithGHKToken_withNSString_withBoolean_(self, token, activeDocStringSeparator_, false);
}

- (jboolean)match_StepLineWithGHKToken:(GHKToken *)token {
  id<JavaUtilList> keywords = [((GHKGherkinDialect *) nil_chk(currentDialect_)) getStepKeywords];
  for (NSString * __strong keyword in nil_chk(keywords)) {
    if ([((id<GHKIGherkinLine>) nil_chk(((GHKToken *) nil_chk(token))->line_)) startsWithWithNSString:keyword]) {
      NSString *stepText = [token->line_ getRestTrimmedWithInt:[((NSString *) nil_chk(keyword)) java_length]];
      [self setTokenMatchedWithGHKToken:token withGHKParser_TokenType:JreLoadEnum(GHKParser_TokenType, StepLine) withNSString:stepText withNSString:keyword withJavaLangInteger:nil withJavaUtilList:nil];
      return true;
    }
  }
  return false;
}

- (jboolean)match_TableRowWithGHKToken:(GHKToken *)token {
  if ([((id<GHKIGherkinLine>) nil_chk(((GHKToken *) nil_chk(token))->line_)) startsWithWithNSString:GHKGherkinLanguageConstants_TABLE_CELL_SEPARATOR]) {
    [self setTokenMatchedWithGHKToken:token withGHKParser_TokenType:JreLoadEnum(GHKParser_TokenType, TableRow) withNSString:nil withNSString:nil withJavaLangInteger:nil withJavaUtilList:[token->line_ getTableCells]];
    return true;
  }
  return false;
}

- (void)dealloc {
  RELEASE_(dialectProvider_);
  RELEASE_(currentDialect_);
  RELEASE_(activeDocStringSeparator_);
  [super dealloc];
}

+ (void)initialize {
  if (self == [GHKTokenMatcher class]) {
    JreStrongAssign(&GHKTokenMatcher_LANGUAGE_PATTERN, JavaUtilRegexPattern_compileWithNSString_(@"^\\s*#\\s*language\\s*:\\s*([a-zA-Z\\-_]+)\\s*$"));
    J2OBJC_SET_INITIALIZED(GHKTokenMatcher)
  }
}

@end

void GHKTokenMatcher_initWithGHKIGherkinDialectProvider_(GHKTokenMatcher *self, id<GHKIGherkinDialectProvider> dialectProvider) {
  NSObject_init(self);
  JreStrongAssign(&self->activeDocStringSeparator_, nil);
  self->indentToRemove_ = 0;
  JreStrongAssign(&self->dialectProvider_, dialectProvider);
  [self reset];
}

GHKTokenMatcher *new_GHKTokenMatcher_initWithGHKIGherkinDialectProvider_(id<GHKIGherkinDialectProvider> dialectProvider) {
  J2OBJC_NEW_IMPL(GHKTokenMatcher, initWithGHKIGherkinDialectProvider_, dialectProvider)
}

GHKTokenMatcher *create_GHKTokenMatcher_initWithGHKIGherkinDialectProvider_(id<GHKIGherkinDialectProvider> dialectProvider) {
  J2OBJC_CREATE_IMPL(GHKTokenMatcher, initWithGHKIGherkinDialectProvider_, dialectProvider)
}

void GHKTokenMatcher_init(GHKTokenMatcher *self) {
  GHKTokenMatcher_initWithGHKIGherkinDialectProvider_(self, create_GHKGherkinDialectProvider_init());
}

GHKTokenMatcher *new_GHKTokenMatcher_init() {
  J2OBJC_NEW_IMPL(GHKTokenMatcher, init)
}

GHKTokenMatcher *create_GHKTokenMatcher_init() {
  J2OBJC_CREATE_IMPL(GHKTokenMatcher, init)
}

void GHKTokenMatcher_initWithNSString_(GHKTokenMatcher *self, NSString *defaultDialectName) {
  GHKTokenMatcher_initWithGHKIGherkinDialectProvider_(self, create_GHKGherkinDialectProvider_initWithNSString_(defaultDialectName));
}

GHKTokenMatcher *new_GHKTokenMatcher_initWithNSString_(NSString *defaultDialectName) {
  J2OBJC_NEW_IMPL(GHKTokenMatcher, initWithNSString_, defaultDialectName)
}

GHKTokenMatcher *create_GHKTokenMatcher_initWithNSString_(NSString *defaultDialectName) {
  J2OBJC_CREATE_IMPL(GHKTokenMatcher, initWithNSString_, defaultDialectName)
}

jboolean GHKTokenMatcher_matchTitleLineWithGHKToken_withGHKParser_TokenType_withJavaUtilList_(GHKTokenMatcher *self, GHKToken *token, GHKParser_TokenType *tokenType, id<JavaUtilList> keywords) {
  for (NSString * __strong keyword in nil_chk(keywords)) {
    if ([((id<GHKIGherkinLine>) nil_chk(((GHKToken *) nil_chk(token))->line_)) startsWithTitleKeywordWithNSString:keyword]) {
      NSString *title = [token->line_ getRestTrimmedWithInt:[((NSString *) nil_chk(keyword)) java_length] + [((NSString *) nil_chk(GHKGherkinLanguageConstants_TITLE_KEYWORD_SEPARATOR)) java_length]];
      [self setTokenMatchedWithGHKToken:token withGHKParser_TokenType:tokenType withNSString:title withNSString:keyword withJavaLangInteger:nil withJavaUtilList:nil];
      return true;
    }
  }
  return false;
}

jboolean GHKTokenMatcher_match_DocStringSeparatorWithGHKToken_withNSString_withBoolean_(GHKTokenMatcher *self, GHKToken *token, NSString *separator, jboolean isOpen) {
  if ([((id<GHKIGherkinLine>) nil_chk(((GHKToken *) nil_chk(token))->line_)) startsWithWithNSString:separator]) {
    NSString *contentType = nil;
    if (isOpen) {
      contentType = [token->line_ getRestTrimmedWithInt:[((NSString *) nil_chk(separator)) java_length]];
      JreStrongAssign(&self->activeDocStringSeparator_, separator);
      self->indentToRemove_ = [((JavaLangInteger *) nil_chk([token->line_ indent])) intValue];
    }
    else {
      JreStrongAssign(&self->activeDocStringSeparator_, nil);
      self->indentToRemove_ = 0;
    }
    [self setTokenMatchedWithGHKToken:token withGHKParser_TokenType:JreLoadEnum(GHKParser_TokenType, DocStringSeparator) withNSString:contentType withNSString:nil withJavaLangInteger:nil withJavaUtilList:nil];
    return true;
  }
  return false;
}

NSString *GHKTokenMatcher_unescapeDocStringWithNSString_(GHKTokenMatcher *self, NSString *text) {
  return self->activeDocStringSeparator_ != nil ? [((NSString *) nil_chk(text)) java_replace:@"\\\"\\\"\\\"" withSequence:@"\"\"\""] : text;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(GHKTokenMatcher)
